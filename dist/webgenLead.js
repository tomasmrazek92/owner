"use strict";(()=>{var l=t=>{let e=localStorage.getItem(t);try{return JSON.parse(e)}catch{return e}};var c="restaurant";var m=()=>{let t=JSON.parse(localStorage.getItem(c)),e=["bar","cafe","bakery","food","restaurant"];for(let o=0;o<e.length;o++)if(t.types.includes(e[o]))return!0;return!1};var p=t=>{let e=t,o=!0;return $(e).prop("required")&&($(e).val()?$(e).is('[type="email"]')?o=b(e):$(e).attr("name")==="restaurant-name"?o=S(e):$(e).is("select")?o=_(e):o=O(e):o=x(e)),o?r($(e),!1):($(e).addClass("error"),console.log($(e)),console.log($(e).val())),o};function b(t){let o=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/.test($(t).val());return r($(t),!o,"Please fill correct email address."),o}function S(t){let e=!0;return e=I(t),e}var u=!1;function I(t){if(u)return u=!1,!0;let e=m();return e?r($(t),!1):r($(t),!0,"Are you sure this is correct? Please update your entry to a recognized restaurant."),u=!0,e}function _(t){let e,o=$(t).siblings(".select2"),n=$(t).siblings(".nice-select");o?e=o.find(".select2-selection--single"):n?e=$(n):e=$(t);let s=!0;return $(t).val()===""?(validArr.push(selectVal),$(e).addClass("is-invalid"),s=!1):$(e).removeClass("is-invalid"),s}function O(t){return r($(t),!1),!0}function x(t){return $(t).attr("name")==="restaurant-name"&&r($(t),!0,"Please select a business location from the search results."),r($(t),!0),!1}var r=(t,e,o)=>{let n=$(t).closest(".form-field-wrapper, [field-wrapper]").find(".field-validation, [field-validation]");$(t).closest(".form-field").toggleClass("error",e),n.toggle(e),o&&n.text(o)};var d=typeof devEnv!="undefined"&&devEnv?"https://dev-api.owner.com":"https://api.owner.com";console.log(d);var h=$(".main-wrapper"),v=$(".growth-loading"),y=$(".growth-error");function E(){$(h,y).fadeOut(500,function(){$(v).fadeIn(400)});let t=$(".growth-loading_step"),e=0;function o(){e<t.length-1&&t.eq(e).fadeOut(1e3,function(){e+=1,t.eq(e).fadeIn(1e3),setTimeout(o,4e3)})}t.hide().eq(e).show(),setTimeout(o,4e3)}function w(){$(h).add(v).hide(),$(y).fadeIn()}function V(t){return l(t).place_id}var P=async t=>{let e=await fetch(`${d}/generator/v1/generations`,{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({googleId:t})});return e.ok||console.error("POST request error:",e.status,await e.text()),await e.json()},k=async t=>await(await fetch(`${d}/generator/v1/generations/${t}`)).json(),g=new Set,G=t=>{let{status:e}=t;return g.has(e)||(console.log("Checking Generation Status:",t),g.add(e)),e},j=async t=>{try{let{id:e}=await P(t);if(!e)throw new Error("Invalid ID received from POST request");return console.log("Website Generation Started"),a("Website Generation Started",t),new Promise((o,n)=>{let s=setInterval(async()=>{let f=await k(e),i=G(f);if(i!=="processing"){if(clearInterval(s),i!=="success")return n(new Error(i));o(f)}},1e3)})}catch(e){let o=e.message.includes("error")||e.message.includes("cancelled")?e.message:"";return{message:e.message,status:o}}};function a(t,e,o){let n=t,s={location:{place_id:e}};o&&(s.location.errorMessage=o),typeof FS!="undefined"&&FS&&FS.event(n,FS.setUserVars(s))}function C(t,e){console.log("Success:",t),a("Website Generation Successful",e),window.location.href=t.redirectUri}function F(t,e){console.log("Error:",t),w(),a("Website Generation Failed",e,respoonse)}function T(t,e){console.log("Error:",t.message),w(),a("Website Generation Failed",e,t.message)}$("[data-form=generateBtn]").on("click",async function(){if(!p($("input[name=restaurant-name]")))return console.log("Validation Invalid");E();let e=V(c);console.log(e);try{let o=await j(e);o&&o.status==="success"?C(o,e):F(o,e)}catch(o){T(o,e)}});})();
