"use strict";(()=>{var i=t=>{let e=localStorage.getItem(t);try{return JSON.parse(e)}catch{return e}};var l="restaurant";var c=()=>!!JSON.parse(localStorage.getItem(l)).types.includes("restaurant");var u=t=>{let e=t,r=!0;return $(e).prop("required")&&($(e).val()?$(e).is('[type="email"]')?r=g(e):$(e).attr("name")==="restaurant-name"?r=h(e):$(e).is("select")?isValid=y(e):r=b(e):r=w(e)),r||$(e).addClass("error"),r};function g(t){let r=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/.test($(t).val());return a($(t),!r,"Please fill correct email address."),r}function h(t){let e=!0;return e=v(t),e}function v(t){let e=c();return e?a($(t),!1):a($(t),!0,"Are you sure this is correct? Please update your entry to a recognized restaurant."),e}function y(t){let e,r=$(t).siblings(".select2"),n=$(t).siblings(".nice-select");r?e=r.find(".select2-selection--single"):n?e=$(n):e=$(t);let s=!0;return $(t).val()===""?(validArr.push(selectVal),$(e).addClass("is-invalid"),s=!1):$(e).removeClass("is-invalid"),s}function b(t){return a($(t),!1),!0}function w(t){return $(t).attr("name")==="restaurant-name"&&a($(t),!0,"Please select a business location from the search results."),a($(t),!0),!1}var a=(t,e,r)=>{let n=$(t).closest(".form-field-wrapper").find(".field-validation");$(t).closest(".form-field").toggleClass("error",e),n.toggle(e),r&&n.text(r)};var d=$(".main-wrapper"),f=$(".growth-loading"),m=$(".growth-error");function S(){$(d,m).hide(),$(f).fadeIn()}function p(){$(d,f).hide(),$(m).fadeIn()}function I(t){return i(t).formatted_address}var _=async t=>{let e=await fetch("https://dev-api.owner.com/generator/v1",{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({address:t})});return e.ok||console.error("POST request error:",e.status,await e.text()),await e.json()},x=async t=>(await fetch(`https://dev-api.owner.com/generator/v1/${t}`)).json(),O=t=>{t.tasks.gmb.status},V=async t=>{try{let{id:e}=await _(t);if(!e)throw new Error("Invalid ID received from POST request");console.log("Website Generation Started"),o("Website Generation Started",t);let r={},n=setInterval(async()=>{r=await x(e);let s=O(r);if((s==="error"||s==="cancelled"||s==="success")&&clearInterval(n),s==="error"||s==="cancelled")throw new Error(s)},1e3);for(;r.status==="processing";)await new Promise(s=>setTimeout(s,1e3));return console.log("Website Generation Successful"),o("Website Generation Successful",t),r.artifacts.funnelUrl}catch(e){let r=e.message.includes("error")||e.message.includes("cancelled")?e.message:"";return{message:e.message,status:r}}};function o(t,e,r=""){let n=t==="success"?"Website Generation Successful":"Website Generation Failed",s={location:{address:e}};r&&(s.location.errorMessage=r),FS.event(n,FS.setUserVars(s))}function E(t,e){console.log("Success:",t),o("Website Generation Successful",e.address),window.location.replace(t.artifacts.funnelUrl)}function F(t,e){console.log("Error:",t),p(),o("Website Generation Failed",e.address)}function G(t,e){console.log("Error:",t.message),p(),o("error",e.address)}$("#generateBtn").on("click",async function(){if(!u($("input[name=restaurant-name]")))return console.log("Validation Invalid");S();let e={address:I(l)};try{let r=await V(e);r.tasks.gmb.status==="success"?E(r,e):F(r,e)}catch(r){G(r,e)}});})();
