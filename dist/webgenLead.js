"use strict";(()=>{var l=t=>{let e=localStorage.getItem(t);try{return JSON.parse(e)}catch{return e}};var c="restaurant";var u=()=>{let t=JSON.parse(localStorage.getItem(c)),e=["bar","cafe","bakery","food","restaurant"];for(let r=0;r<e.length;r++)if(t.types.includes(e[r]))return!0;return!1};var f=t=>{let e=t,r=!0;return $(e).prop("required")&&($(e).val()?$(e).is('[type="email"]')?r=w(e):$(e).attr("name")==="restaurant-name"?r=b(e):$(e).is("select")?isValid=I(e):r=_(e):r=x(e)),r||$(e).addClass("error"),r};function w(t){let r=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/.test($(t).val());return a($(t),!r,"Please fill correct email address."),r}function b(t){let e=!0;return e=S(t),e}var d=!1;function S(t){if(d)return!0;let e=u();return e?a($(t),!1):a($(t),!0,"Are you sure this is correct? Please update your entry to a recognized restaurant."),d=!0,e}function I(t){let e,r=$(t).siblings(".select2"),s=$(t).siblings(".nice-select");r?e=r.find(".select2-selection--single"):s?e=$(s):e=$(t);let n=!0;return $(t).val()===""?(validArr.push(selectVal),$(e).addClass("is-invalid"),n=!1):$(e).removeClass("is-invalid"),n}function _(t){return a($(t),!1),!0}function x(t){return $(t).attr("name")==="restaurant-name"&&a($(t),!0,"Please select a business location from the search results."),a($(t),!0),!1}var a=(t,e,r)=>{let s=$(t).closest(".form-field-wrapper").find(".field-validation");$(t).closest(".form-field").toggleClass("error",e),s.toggle(e),r&&s.text(r)};var p=$(".main-wrapper"),g=$(".growth-loading"),h=$(".growth-error");function O(){$(p,h).fadeOut(500,function(){$(g).fadeIn(400)});let t=$(".growth-loading_step"),e=0;function r(){e<t.length-1&&t.eq(e).fadeOut(1e3,function(){e++,t.eq(e).fadeIn(1e3),setTimeout(r,5e3)})}t.hide().eq(e).show(),setTimeout(r,5e3)}function v(){$(p,g).hide(),$(h).fadeIn()}function V(t){return l(t).place_id}var E=async t=>{let e=await fetch("https://dev-api.owner.com/generator/v1",{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({googleId:t})});return e.ok||console.error("POST request error:",e.status,await e.text()),await e.json()},F=async t=>await(await fetch(`https://dev-api.owner.com/generator/v1/${t}`)).json(),m=new Set,G=t=>{let{status:e}=t;return m.has(e)||(console.log("Checking Generation Status:",t),m.add(e)),e},R=async t=>{try{let{id:e}=await E(t);if(!e)throw new Error("Invalid ID received from POST request");console.log("Website Generation Started"),i("Website Generation Started",t);let r={};return new Promise((s,n)=>{let y=setInterval(async()=>{r=await F(e);let o=G(r);(o==="error"||o==="cancelled"||o==="success")&&clearInterval(y),(o==="error"||o==="cancelled")&&n(new Error(o)),o==="success"&&(console.log("Website Generation Successful",r),i("Website Generation Successful",t),s(r))},1e3)})}catch(e){let r=e.message.includes("error")||e.message.includes("cancelled")?e.message:"";return{message:e.message,status:r}}};function i(t,e,r=""){let s=t==="success"?"Website Generation Successful":"Website Generation Failed",n={location:{place_id:e}};r&&(n.location.errorMessage=r),FS.event(s,FS.setUserVars(n))}function C(t,e){console.log("Success:",t),i("Website Generation Successful",e),window.location.href=`https://dev.ordersave.com/partnersite/${t.brandId}`}function P(t,e){console.log("Error:",t),v(),i("Website Generation Failed",e)}function j(t,e){console.log("Error:",t.message),v(),i("error",e)}$("[data-form=generateBtn]").on("click",async function(){if(!f($("input[name=restaurant-name]")))return console.log("Validation Invalid");O();let e=V(c);console.log(e);try{let r=await R(e);r&&r.status==="success"?C(r,e):P(r,e)}catch(r){j(r,e)}});})();
